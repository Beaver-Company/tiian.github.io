<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Examples with Oracle Database Server</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="home" href="index.html" title="LIXA Reference Guide (version 1.5.3-dev)" /><link rel="up" href="ch05.html" title="Chapter 5. Developing C Application Programs using TX (Transaction Demarcation) interface" /><link rel="prev" href="ch05s03.html" title="The first example" /><link rel="next" href="ch05s05.html" title="An example with IBM DB2 DBMS" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Examples with Oracle Database Server</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch05s03.html">Prev</a> </td><th width="60%" align="center">Chapter 5. Developing C Application Programs using TX (Transaction
  Demarcation) interface</th><td width="20%" align="right"> <a accesskey="n" href="ch05s05.html">Next</a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="Development_example2_ora"></a>Examples with Oracle Database Server</h2></div></div></div><p>
      This section contains many examples related to different configurations:
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	  the Application Program can be executed inside the same system that
	  hosts the Resource Manager (Oracle Database) or in a different
	  system. The first configuration is named "local" and necessitates
	  only the Oracle Database Server software. The second configuration
	  is named "remote" or "network" and necessitates both the Oracle
	  Database Server and the Oracle Instant Client software
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  the C Application Program can be developed using Oracle Call 
	  Interface (OCI) or using embedded SQL that must precompiled using
	  the Oracle Pro*C precompiler. OCI, Pro*C and XA are not compatible.
	</p></li></ul></div><p>
      The following picture shows the overall architecture from the logical
      point of view, but it's not a deploy model.
    </p><div class="figure"><a id="develop2"></a><p class="title"><strong>Figure 5.2. Deploy model of an example with Oracle Database Server</strong></p><div class="figure-contents"><div class="mediaobject"><img src="../images/LIXA_Development_2.png" alt="Deploy model of an example with Oracle Database Server" /></div></div></div><br class="figure-break" /><p>
      Using a real Resource Manager, like a DBMS, requires some extra effort
      because you have to set-up the environment needed by the Resource
      Manager. The examples explained in this section was developed using
      different configurations: 
      </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	  Oracle Database 10g Release 2 and 11g Release 2 Express Edition 
	  using a <span class="emphasis"><em>local</em></span> connection
	</p></li><li class="listitem" style="list-style-type: disc"><p>
	  Oracle Database 12c Release 1 (12.1) Standard Edition using a
	  <span class="emphasis"><em>remote (SqlNet)</em></span> connection
	</p></li></ul></div><p>
      If you use a different configuration, you will need to fix some of the
      details shown by these examples.
      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  If you did not yet installed the software provided by Oracle,
	  please refer to the official Oracle site to download the
	  software and to pick-up the information necessary to install 
	  and configure
	  the database. This manual does not give you information related
	  to Oracle technology: it is assumed that you have already installed 
	  and configured the database.
      </p></div><p>
      </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
      The LIXA software must be configured, compiled and installed to support 
      the Oracle Database Server resource manager as explained in 
      <a class="xref" href="ch02s04.html#Linking_third_party_resource_managers" title="Linking third party resource managers">the section called “Linking third party resource managers”</a>.
      </p></div><p>
    </p><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp56756512"></a>Local configuration (Server) and OCI</h3></div></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Development_setup_Oracle_environment"></a>Set-up the Oracle environment (server side)</h4></div></div></div><p>
	  The following example is based on Oracle XE 10.2 and 11.2, but
	  there shouldn't be too much differences with other Oracle
	  versions.
	</p><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp56758176"></a>Start-up the Oracle server</h5></div></div></div><p>
	    If the database server was not running, you can start it
	    with these commands
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ sudo /etc/init.d/oracle-xe enable
tiian@ubuntu:~/tmp$ sudo /etc/init.d/oracle-xe start
Starting Oracle Net Listener.
Starting Oracle Database 10g Express Edition Instance.
	    </pre><p>
	    on some systems, like Ubuntu 10.04, you use somethig like
	    this:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ sudo service oracle-xe enable
tiian@ubuntu:~/tmp$ sudo service oracle-xe start
Starting Oracle Net Listener.
Starting Oracle Database 11g Express Edition Instance.
	    </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp56760240"></a>Create the XA related views</h5></div></div></div><p>
	    First of all you must be able to connect as <span class="quote">“<span class="quote">SYSDBA</span>”</span>
	    from a terminal session; the commands below show what happens when
	    I connect to the Oracle server using the user 
	    <code class="systemitem">sys</code> with password
	    <span class="quote">“<span class="quote">oracle</span>”</span>
	    <a href="#ftn.idp56763088" class="footnote" id="idp56763088"><sup class="footnote">[21]</sup></a>
	    <a href="#ftn.idp56766160" class="footnote" id="idp56766160"><sup class="footnote">[22]</sup></a>:
	      </p><pre class="screen">
tiian@ubuntu:~$ sudo su - oracle
oracle@ubuntu:~$ echo $ORACLE_HOME
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
oracle@ubuntu:~$ sqlplus "sys/oracle as sysdba"

SQL*Plus: Release 10.2.0.1.0 - Production on Thu Apr 7 22:23:56 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	      </pre><p>
	      You must check the file <code class="filename">xaview.sql</code>:
	      </p><pre class="screen">
oracle@ubuntu:~$ ls -la $ORACLE_HOME/rdbms/admin/xaview.sql
-rw-r--r-- 1 oracle dba 1754 2006-02-24 06:18 /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/rdbms/admin/xaview.sql
	      </pre><p>
	      It contains the SQL instructions necessary to create two specific
	      system views that could be not defined in your database; the
	      following commands are related to a database that contains
	      the desired views:
	      </p><pre class="screen">
oracle@ubuntu:~$ sqlplus "sys/oracle as sysdba"

SQL*Plus: Release 10.2.0.1.0 - Production on Thu Apr 7 22:32:45 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from v$pending_xatrans$;

no rows selected

SQL&gt; select * from v$xatrans$;

no rows selected

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	      </pre><p>
	      If the command failed the views would be not defined and you
	      would get something like this:
	      </p><pre class="screen">
oracle@ubuntu:~$ sqlplus "sys/oracle as sysdba"

SQL*Plus: Release 10.2.0.1.0 - Production on Fri Apr 29 22:20:01 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from v$pending_xatrans$;
select * from v$pending_xatrans$
              *
ERROR at line 1:
ORA-00942: table or view does not exist


SQL&gt; select * from v$xatrans$;
select * from v$xatrans$
              *
ERROR at line 1:
ORA-00942: table or view does not exist


SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	      </pre><p>
	      you can create them with a command like this:
	      </p><pre class="screen">
oracle@ubuntu:~$ cat $ORACLE_HOME/rdbms/admin/xaview.sql | sqlplus "sys/oracle as sysdba"

SQL*Plus: Release 10.2.0.1.0 - Production on Fri Apr 29 22:25:48 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; SQL&gt; DROP VIEW v$xatrans$
*
ERROR at line 1:
ORA-00942: table or view does not exist


SQL&gt; DROP VIEW v$pending_xatrans$
*
ERROR at line 1:
ORA-00942: table or view does not exist


SQL&gt; SQL&gt; SQL&gt;   2    3    4    5    6    7    8
View created.

SQL&gt; SQL&gt; SQL&gt; SQL&gt;   2    3    4    5    6    7    8    9   10   11
View created.

SQL&gt; SQL&gt; SQL&gt; Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	      </pre><p>
	    </p></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp56760800"></a>Authorize the XA related views</h5></div></div></div><p>
	      The example programs supplied by the LIXA project are designed
	      to use the 
	      <code class="systemitem">hr</code> user; you 
	      <span class="emphasis"><em>must</em></span> grant
	      the necessary privileges to all the users you want to use for
	      your Application Programs. The below commands show how to grant
	      the necessary privileges to
	      <code class="systemitem">hr</code>:
	      </p><pre class="screen">
oracle@ubuntu:~$ sqlplus "sys/oracle as sysdba"

SQL*Plus: Release 10.2.0.1.0 - Production on Thu Apr 7 22:44:44 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; grant select on dba_pending_transactions to hr;

Grant succeeded.

SQL&gt; grant select on v$pending_xatrans$ to hr;

Grant succeeded.

SQL&gt; grant select on v$xatrans$ to hr;

Grant succeeded.

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	      </pre><p>
	    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	      If the user
	      <code class="systemitem">hr</code> did not exist and
	      the above commands failed,
	      you should read Oracle documentation and pick-up the necessary
	      information to create it.
	    </p></div></div><div class="section"><div class="titlepage"><div><div><h5 class="title"><a id="idp56780144"></a>Unlock <span class="quote">“<span class="quote"><code class="systemitem">hr</code></span>”</span> Oracle user</h5></div></div></div><p>
	      The example programs supplied by the LIXA project are designed
	      to use the 
	      <code class="systemitem">hr</code> user; it might be 
	      <span class="emphasis"><em>locked</em></span> after Oracle software installation.
	      The below commands show how to unlock it:
	      </p><pre class="screen">
oracle@ubuntu:~$ sqlplus "sys/oracle as sysdba"

SQL*Plus: Release 10.2.0.1.0 - Production on Thu Apr 7 22:44:44 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; ALTER USER hr ACCOUNT UNLOCK;

User altered.

SQL&gt; ALTER USER hr IDENTIFIED BY hr;

User altered.

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	      </pre><p>
	      You may perform the same operation using the graphical (web 
	      based) interface.
	      </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
		Newer Oracle database versions set a default password limit: 
		after such a limit, Oracle will start to issue
		<span class="command"><strong>ORA-28002</strong></span> messages and XA functions will
		return with an error like below:
		</p><pre class="screen">
215229.2063.1888967424.1:
ORA-28002: the password will expire within 6 days

215229.2063.1888967424.1:
xaolgn: XAER_RMERR; logon failed. ORA-28002.

215229.2063.1888967424.1:
xaoopen: return -3
		</pre><p>
		To avoid this potential error, configure your users in the
		right way.
	      </p></div><p>
	    </p></div></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56785776"></a>Start the LIXA state server</h4></div></div></div><p>
            The LIXA state server (daemon) must be started as explained in
            <a class="xref" href="ch04.html#Starting_the_state_server" title="Starting the state server (lixad)">the section called “Starting the state server (<span class="command"><strong>lixad</strong></span>)”</a>.
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56787168"></a>Build the client program</h4></div></div></div><p>
	    Prepare the client (Application Program) using the below commands
	    (<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	    using <span class="command"><strong>\</strong></span> to help readability, but you may use
	    a single line):
	    </p><div class="table"><table frame="box"><thead><tr><td>System configuration details:</td></tr></thead><tbody><tr><td>
		Local connection, Ubuntu 8.04, Oracle XE 10.2 Database Server
		<pre class="screen">
tiian@ubuntu:~$ mkdir tmp
tiian@ubuntu:~$ cd tmp
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example2_ora.c .
tiian@ubuntu:~/tmp$ gcc example2_ora.c $(/opt/lixa/bin/lixa-config -c -f -l -d) \
&gt; -I/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/rdbms/public \
&gt; -L/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib -l clntsh -l nnz10 \
&gt; -o example2_ora
		</pre>
	      </td></tr></tbody></table></div><p>
	    </p><div class="table"><table frame="box"><thead><tr><td>System configuration details:</td></tr></thead><tbody><tr><td>
		Local connection, Ubuntu 10.04, Oracle XE 11.2 Database Server
		<pre class="screen">
tiian@ubuntu:~$ mkdir tmp
tiian@ubuntu:~$ cd tmp
tiian@ubuntu:~/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example2_ora.c .
tiian@ubuntu:~/tmp$ gcc example2_ora.c $(/opt/lixa/bin/lixa-config -c -f -l -d) \
&gt; -I/u01/app/oracle/product/11.2.0/xe/rdbms/public/ \
&gt; -L/u01/app/oracle/product/11.2.0/xe/lib/ -l clntsh -l nnz11 \
&gt; -o example2_ora
		</pre>
	      </td></tr></tbody></table></div><p>
	    Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example2_ora
        linux-gate.so.1 =&gt;  (0xb7709000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb76ee000)
        libclntsh.so.10.1 =&gt; not found
        libnnz10.so =&gt; not found
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb7590000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb758c000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb7588000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb7583000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb7579000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb74c8000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb73a8000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb7393000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb736e000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb7356000)
        /lib/ld-linux.so.2 (0xb770a000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb732e000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb7319000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb7315000)
	    </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56787680"></a>Set-up LIXA environment</h4></div></div></div><p>
	    There are three unresolved references that can be fixed setting up
	    the environment properly:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH

tiian@ubuntu:~/tmp$ export LD_LIBRARY_PATH=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib

tiian@ubuntu:~/tmp$ echo $LD_LIBRARY_PATH
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib
	    </pre><p>
	    Check again the executable:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ ldd example2_ora
        linux-gate.so.1 =&gt;  (0xb76f9000)
        liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0xb76de000)
        libclntsh.so.10.1 =&gt; /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib/libclntsh.so.10.1 (0xb692a000)
        libnnz10.so =&gt; /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/lib/libnnz10.so (0xb6724000)
        libc.so.6 =&gt; /lib/tls/i686/cmov/libc.so.6 (0xb65c7000)
        libgmodule-2.0.so.0 =&gt; /usr/lib/libgmodule-2.0.so.0 (0xb65c3000)
        libdl.so.2 =&gt; /lib/tls/i686/cmov/libdl.so.2 (0xb65bf000)
        libgthread-2.0.so.0 =&gt; /usr/lib/libgthread-2.0.so.0 (0xb65ba000)
        librt.so.1 =&gt; /lib/tls/i686/cmov/librt.so.1 (0xb65b0000)
        libglib-2.0.so.0 =&gt; /usr/lib/libglib-2.0.so.0 (0xb64ff000)
        libxml2.so.2 =&gt; /usr/lib/libxml2.so.2 (0xb63df000)
        liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0xb63ca000)
        libm.so.6 =&gt; /lib/tls/i686/cmov/libm.so.6 (0xb63a5000)
        libpthread.so.0 =&gt; /lib/tls/i686/cmov/libpthread.so.0 (0xb638d000)
        libnsl.so.1 =&gt; /lib/tls/i686/cmov/libnsl.so.1 (0xb6374000)
        /lib/ld-linux.so.2 (0xb76fa000)
        libpcre.so.3 =&gt; /usr/lib/libpcre.so.3 (0xb634d000)
        libz.so.1 =&gt; /usr/lib/libz.so.1 (0xb6338000)
        libuuid.so.1 =&gt; /lib/libuuid.so.1 (0xb6334000)
	    </pre><p>
	    Set-up the necessary environment variables.
	    Here's an example for Oracle XE 10.2 using a local connection and 
	    the SID identifier:
	    </p><div class="table"><table frame="box"><thead><tr><td>System configuration details:</td></tr></thead><tbody><tr><td>
		Local connection, Ubuntu 8.04, Oracle XE 10.2 Database Server
		<pre class="screen">
tiian@ubuntu:~/tmp$ export PATH=$PATH:$ORACLE_HOME/bin
tiian@ubuntu:~/tmp$ echo $PATH
/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin
tiian@ubuntu:~/tmp$ export ORACLE_HOME=/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
tiian@ubuntu:~/tmp$ echo $ORACLE_HOME
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server
tiian@ubuntu:~/tmp$ export ORACLE_SID=XE
tiian@ubuntu:~/tmp$ echo $ORACLE_SID
XE
tiian@ubuntu:~/tmp$ export LIXA_PROFILE=ORA_DYN
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
ORA_DYN
		</pre>
	      </td></tr></tbody></table></div><p>
	    It is suggested to set the necessary environment variables in your 
	    profile if you are going to execute the programs many times.
	    This is the list of the suggested variables:
	    <code class="varname">LD_LIBRARY_PATH</code>,
	    <code class="varname">LIXA_PROFILE</code>,
	    <code class="varname">ORACLE_HOME</code>,
	    <code class="varname">ORACLE_SID</code>.
	    </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	      the third and fourth variables can be
	      set sourcing <code class="filename">oracle_env.sh</code> script: it's
	      installed in the Oracle's <code class="filename">bin</code> directory or
	      alternatively you have to edit your own as explained above.
	    </p></div><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56796544"></a>Check the data table before execution</h4></div></div></div><p>
	    Execute the below commands to check the existence of table
	    <code class="filename">countries</code> and to create a new table with
	    name <code class="filename">authors</code>:
	    </p><pre class="screen">
tiian@ubuntu:~$ sqlplus "hr/hr"<a href="#ftn.idp56807600" class="footnote" id="idp56807600"><sup class="footnote">[23]</sup></a>

SQL*Plus: Release 10.2.0.1.0 - Production on Thu Apr 14 22:04:55 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected

SQL&gt; CREATE TABLE hr.authors (
  2  id INTEGER NOT NULL,
  3  last_name VARCHAR2(20),
  4  first_name VARCHAR2(20));

Table created.

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	    </pre><p>
	    That's OK because the table does not contain the row we 
	    are going to insert.
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56809520"></a>Some checks before program execution</h4></div></div></div><p>
	    We set <code class="varname">LIXA_PROFILE</code> to value
	    <span class="quote">“<span class="quote">ORA_DYN</span>”</span>, looking at
	    <code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	    </p><pre class="screen">
    &lt;profile name="ORA_DYN"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;OracleXE_dynreg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	    </pre><p>
	    the profile references the Resource Manager named
	    <span class="quote">“<span class="quote">OracleXE_dynreg</span>”</span>, looking again at the config file:
	    </p><pre class="screen">
    &lt;rsrmgr name="OracleXE_dynreg" switch_file="/opt/lixa/lib/switch_oracle_dynreg.so" xa_open_info="Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+Loose_Coupling=true" xa_close_info="" /&gt;
	    </pre><p>
	    we can discover that our application will access the Oracle
	    database using <code class="systemitem">hr</code>
	    user and writing the trace file to directory 
	    <code class="filename">/tmp</code> (see <code class="constant">LogDir</code>)
	    <a href="#ftn.idp56815264" class="footnote" id="idp56815264"><sup class="footnote">[24]</sup></a>. Verify no trace file exists:
	      </p><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la /tmp/xa*
ls: cannot access /tmp/xa*: No such file or directory
	      </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56810080"></a>Program execution (dynamic registration)</h4></div></div></div><p>
	    Execute the client program as shown below:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example2_ora
INSERT statement executed!
First arg is not 'DELETE', bypassing DELETE statement...
	    </pre><p>
	    Check the table after program execution:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ sqlplus "hr/hr"

SQL*Plus: Release 10.2.0.1.0 - Production on Sun Apr 10 10:34:23 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

CO COUNTRY_NAME                              REGION_ID
-- ---------------------------------------- ----------
RS Repubblica San Marino                             1

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	    </pre><p>
	    The example program <code class="filename">example2_ora</code> inserted a
	    row in table <code class="constant">COUNTRIES</code>. Take a look to the
	    trace produced by the Oracle client library:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la /tmp/xa*
-rw-r--r-- 1 tiian tiian 1723 2011-04-10 10:33 /tmp/xa_NULL04102011.trc
tiian@ubuntu:~/tmp$ cat /tmp/xa_NULL04102011.trc

ORACLE XA: Version 10.2.0.1.0. RM name = 'Oracle_XA'.

103352.5300.3057182448.0:
xaoopen: xa_info=Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+Loose_Coupling=true,rmid=0,flags=0x0

103352.5300.3057182448.0:
xaolgn_help: version#: 169869568 banner: Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

103352.5300.3057182448.0:
xaolgn: sqlxrc/sqlxss completed

103352.5300.3057182448.0:
xaolgn2: return XA_OK

103352.5300.3057182448.0:
xaoopen: xaolgn completed

103352.5300.3057182448.0:
xaoopen: return 0

103352.5300.3057182448.0:
ax_reg: xid=0x494c4158-8c6122ac9fd0477ebfe5f650e21a3539-a154ad9214d0544a3abbd33c8c2ba36f, rmid=0, flags=0x0

103352.5300.3057182448.0:
OCITransStart: Attempting

103352.5300.3057182448.0:
OCITransStart: Succeeded

103352.5300.3057182448.0:
xaodynpo 2: rmid=0, state=3

103352.5300.3057182448.0:
xaoend: xid=0x494c4158-8c6122ac9fd0477ebfe5f650e21a3539-a154ad9214d0544a3abbd33c8c2ba36f, rmid=0, flags=0x4000000

103352.5300.3057182448.0:
OCITransDetach: Attempting

103352.5300.3057182448.0:
OCITransDetach: Succeeded

103352.5300.3057182448.0:
xaoend: return 0

103352.5300.3057182448.0:
xaocommit: xid=0x494c4158-8c6122ac9fd0477ebfe5f650e21a3539-a154ad9214d0544a3abbd33c8c2ba36f, rmid=0, flags=0x40000000

103352.5300.3057182448.0:
OCITransCommit: Attempting

103352.5300.3057182448.0:
xaodynpo 2: rmid=0, state=1

103352.5300.3057182448.0:
OCITransCommit: Succeeded

103352.5300.3057182448.0:
xaocommit: rtn 0

103352.5300.3057182448.0:
xaoclose: xa_info=, rmid=0, flags=0x0

103352.5300.3057182448.0:
OCIServerDetach: Attempting

103352.5300.3057182448.0:
OCIServerDetach: Succeeded

103352.5300.3057182448.0:
xaoclose: rtn 0
	    </pre><p>
	    The <code class="function">ax_reg</code> function was called because the
	    dynamic registration configuration was used 
	    (<code class="constant">LIXA_PROFILE=ORA_DYN</code>). 
	    Now you can remove
	    the inserted record using the same program:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example2_ora delete
First arg is 'delete', bypassing INSERT statement...
DELETE statement executed!
	    </pre><p>
	    Check the content of the table again:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ sqlplus "hr/hr"

SQL*Plus: Release 10.2.0.1.0 - Production on Sun Apr 10 10:40:25 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	    </pre><p>
	    The row was deleted. Please remove the trace file before a new
	    execution:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ rm /tmp/xa_NULL04102011.trc
	    </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56817360"></a>Program execution (static registration)</h4></div></div></div><p>
	    Switch from dynamic registration to static registration (local
	    connection):
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
ORA_DYN
tiian@ubuntu:~/tmp$ export LIXA_PROFILE=ORA_STA
tiian@ubuntu:~/tmp$ echo $LIXA_PROFILE
ORA_STA
	    </pre><p>
	    Here's the equivalent for the network connection using Oracle
	    Instant Client:
	    </p><pre class="screen">
tiian@ubuntu1404-64:/tmp$ echo $LIXA_PROFILE
ORAOCI_DYN
tiian@ubuntu1404-64:/tmp$ export LIXA_PROFILE=ORAOCI_STA
tiian@ubuntu1404-64:/tmp$ echo $LIXA_PROFILE
ORAOCI_STA	  
	    </pre><p>
	    Execute the program again:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example2_ora
INSERT statement executed!
First arg is not 'DELETE', bypassing DELETE statement...
tiian@ubuntu:~/tmp$ sqlplus "hr/hr"

SQL*Plus: Release 10.2.0.1.0 - Production on Sun Apr 10 10:53:05 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

CO COUNTRY_NAME                              REGION_ID
-- ---------------------------------------- ----------
RS Repubblica San Marino                             1

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	    </pre><p>
	    Inspect the produced trace file:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ ls -la /tmp/xa_*
-rw-r--r-- 1 tiian tiian 1661 2011-04-10 10:52 /tmp/xa_NULL04102011.trc
tiian@ubuntu:~/tmp$ cat /tmp/xa_NULL04102011.trc

ORACLE XA: Version 10.2.0.1.0. RM name = 'Oracle_XA'.

105236.5392.3057456880.0:
xaoopen: xa_info=Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+Loose_Coupling=true,rmid=0,flags=0x0

105236.5392.3057456880.0:
xaolgn_help: version#: 169869568 banner: Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

105236.5392.3057456880.0:
xaolgn: sqlxrc/sqlxss completed

105236.5392.3057456880.0:
xaolgn: return XA_OK

105236.5392.3057456880.0:
xaoopen: xaolgn completed

105236.5392.3057456880.0:
xaoopen: return 0

105236.5392.3057456880.0:
xaostart: xid=0x494c4158-6119154810784a87b0d0aa83ea497a72-55263ef9237e27f8ae34f46936ce295d, rmid=0, flags=0x0

105236.5392.3057456880.0:
OCITransStart: Attempting

105236.5392.3057456880.0:
OCITransStart: Succeeded

105236.5392.3057456880.0:
xaostart: return XA_OK

105236.5392.3057456880.0:
xaoend: xid=0x494c4158-6119154810784a87b0d0aa83ea497a72-55263ef9237e27f8ae34f46936ce295d, rmid=0, flags=0x4000000

105236.5392.3057456880.0:
OCITransDetach: Attempting

105236.5392.3057456880.0:
OCITransDetach: Succeeded

105236.5392.3057456880.0:
xaoend: return 0

105236.5392.3057456880.0:
xaocommit: xid=0x494c4158-6119154810784a87b0d0aa83ea497a72-55263ef9237e27f8ae34f46936ce295d, rmid=0, flags=0x40000000

105236.5392.3057456880.0:
OCITransCommit: Attempting

105236.5392.3057456880.0:
OCITransCommit: Succeeded

105236.5392.3057456880.0:
xaocommit: rtn 0

105236.5392.3057456880.0:
xaoclose: xa_info=, rmid=0, flags=0x0

105236.5392.3057456880.0:
OCIServerDetach: Attempting

105236.5392.3057456880.0:
OCIServerDetach: Succeeded

105236.5392.3057456880.0:
xaoclose: rtn 0
	    </pre><p>
	    The <code class="function">xa_start (xaostart)</code> function was called 
	    because the static registration configuration was used 
	    (<code class="constant">LIXA_PROFILE=ORA_STA</code>). 
	    Remove the inserted row again:
	    </p><pre class="screen">
tiian@ubuntu:~/tmp$ ./example2_ora delete
First arg is 'delete', bypassing INSERT statement...
DELETE statement executed!
tiian@ubuntu:~/tmp$ sqlplus "hr/hr"

SQL*Plus: Release 10.2.0.1.0 - Production on Sun Apr 10 11:01:32 2011

Copyright (c) 1982, 2005, Oracle.  All rights reserved.


Connected to:
Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected

SQL&gt; exit
Disconnected from Oracle Database 10g Express Edition Release 10.2.0.1.0 - Production
	    </pre><p>
	    You have successfully executed an Application Program that uses
	    Oracle Database Server as a Resource Manager.
	  </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp56825824"></a>Remote configuration (Instant Client) and OCI</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  This example has been tested using Ubuntu Server LTS 14.04
	  and Oracle Instant Client 12.1
	</p></div><p>
	  Using a remote configuration instead of a local configuration
	  introduces two differences:
	  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      the Oracle Database Server must be configured to be accessible
	      from another system: a <span class="emphasis"><em>listener</em></span> must be
	      configured
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
	      the Oracle Instant Client software must be installed and 
	      configured in the system that will connect to the database
	    </p></li></ul></div><p>
	</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56836608"></a>Set-up the Oracle environment (server side)</h4></div></div></div><p>
	    The first part of the Oracle Database Server is pretty the same
	    described in 
	    <a class="xref" href="ch05s04.html#Development_setup_Oracle_environment" title="Set-up the Oracle environment (server side)">the section called “Set-up the Oracle environment (server side)”</a>.
	    All the statements remain valid for Oracle 12c Standard 
	    Edition with the exception of the paths. Here's a default path 
	    installation example:
	    </p><pre class="screen">
[oracle@centos7-oracle12 ~]$ ls -la $ORACLE_HOME/rdbms/admin/xaview.sql
-rw-r--r--. 1 oracle oinstall 1941 Apr 21  2011 /u01/app/oracle/product/12.1.0/dbhome_1/rdbms/admin/xaview.sql
	    </pre><p>	    
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Development_configure_Oracle_listener"></a>Configure Oracle Listener</h4></div></div></div><div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Warning</h3><p>
	    Many recent Linux distributions, CentOS 7.x for example, 
	    automatically enable an internal firewall to prevent undesired 
	    accesses. If your firewall configuration does not allow Oracle 
	    traffic, you have no way to reach your database instance from 
	    a different system.
	  </p></div><p>
	    Here's a very basic example that accepts incoming connection from
	    any network interface (IP address 0.0.0.0):
	    </p><pre class="screen">
[oracle@centos7-oracle12 ~]$ cat $ORACLE_HOME/network/admin/listener.ora

LISTENER =
  (DESCRIPTION_LIST =
    (DESCRIPTION =
      (ADDRESS = (PROTOCOL = TCP)(HOST = 0.0.0.0)(PORT = 1521))
      (ADDRESS = (PROTOCOL = IPC)(KEY = EXTPROC1521))
    )
  )
	    </pre><p>
	    You can check that the listener is accepting connection with this
	    command:
	    </p><pre class="screen">
[oracle@centos7-oracle12 ~]$ netstat -unta | grep 1521 | grep LISTEN
tcp        0      0 0.0.0.0:1521            0.0.0.0:*               LISTEN     
	    </pre><p>
	    and you can check a connection from a different system with 
	    something	like this (adjust your IP address, port and Global 
	    Database Name):
	    </p><pre class="screen">
tiian@ubuntu1404-64:~$ sqlplus hr/hr@192.168.122.81:1521/orcl.brenta.org

SQL*Plus: Release 12.1.0.2.0 Production on Fri Jan 13 21:50:46 2017

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Fri Jan 13 2017 21:36:05 +01:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt; exit
Disconnected from Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production
	    </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="Development_install_Oracle_Instant_Client"></a>Install and configure Oracle Instant Client</h4></div></div></div><p>
	    Oracle Instant Client must be retrieved from Oracle portal. 
	    These are the suggested packages for version 12.1 if you want 
	    to use LIXA:
	    </p><pre class="screen">
instantclient-basic-linux.x64-12.1.0.2.0.zip
instantclient-precomp-linux.x64-12.1.0.2.0.zip
instantclient-sdk-linux.x64-12.1.0.2.0.zip
instantclient-sqlplus-linux.x64-12.1.0.2.0.zip
	    </pre><p>
	    For the Linux operating system you can choose between ".rpm" 
	    packages and ".zip" archives: feel free to install the packages 
	    that you prefer.
	    Just as an example, here's the final layout of a tested 
	    configuration using <code class="filename">/opt/oracle</code> as a prefix:
	    </p><pre class="screen">
tiian@ubuntu1404-64:~/lixa$ find /opt/oracle/ | sort
/opt/oracle/
/opt/oracle/instantclient_12_1
/opt/oracle/instantclient_12_1/adrci
/opt/oracle/instantclient_12_1/BASIC_README
/opt/oracle/instantclient_12_1/cobsqlintf.o
/opt/oracle/instantclient_12_1/genezi
/opt/oracle/instantclient_12_1/glogin.sql
/opt/oracle/instantclient_12_1/libclntshcore.so.12.1
/opt/oracle/instantclient_12_1/libclntsh.so
/opt/oracle/instantclient_12_1/libclntsh.so.12.1
/opt/oracle/instantclient_12_1/libipc1.so
/opt/oracle/instantclient_12_1/libmql1.so
/opt/oracle/instantclient_12_1/libnnz12.so
/opt/oracle/instantclient_12_1/libocci.so
/opt/oracle/instantclient_12_1/libocci.so.12.1
/opt/oracle/instantclient_12_1/libociei.so
/opt/oracle/instantclient_12_1/libocijdbc12.so
/opt/oracle/instantclient_12_1/libons.so
/opt/oracle/instantclient_12_1/liboramysql12.so
/opt/oracle/instantclient_12_1/libsqlplusic.so
/opt/oracle/instantclient_12_1/libsqlplus.so
/opt/oracle/instantclient_12_1/network
/opt/oracle/instantclient_12_1/network/admin
/opt/oracle/instantclient_12_1/network/admin/tnsnames.ora
/opt/oracle/instantclient_12_1/ojdbc6.jar
/opt/oracle/instantclient_12_1/ojdbc7.jar
/opt/oracle/instantclient_12_1/precomp
/opt/oracle/instantclient_12_1/precomp/admin
/opt/oracle/instantclient_12_1/precomp/admin/pcbcfg.cfg
/opt/oracle/instantclient_12_1/precomp/admin/pcscfg.cfg
/opt/oracle/instantclient_12_1/PRECOMP_README
/opt/oracle/instantclient_12_1/sdk
/opt/oracle/instantclient_12_1/sdk/admin
/opt/oracle/instantclient_12_1/sdk/admin/oraaccess.xsd
/opt/oracle/instantclient_12_1/sdk/demo
/opt/oracle/instantclient_12_1/sdk/demo/cdemo81.c
/opt/oracle/instantclient_12_1/sdk/demo/demo.mk
/opt/oracle/instantclient_12_1/sdk/demo/demo_proc_ic.mk
/opt/oracle/instantclient_12_1/sdk/demo/demo_procob_ic.mk
/opt/oracle/instantclient_12_1/sdk/demo/occidemod.sql
/opt/oracle/instantclient_12_1/sdk/demo/occidemo.sql
/opt/oracle/instantclient_12_1/sdk/demo/occidml.cpp
/opt/oracle/instantclient_12_1/sdk/demo/occiobj.cpp
/opt/oracle/instantclient_12_1/sdk/demo/occiobj.typ
/opt/oracle/instantclient_12_1/sdk/demo/oraaccess.xml
/opt/oracle/instantclient_12_1/sdk/demo/procdemo.pc
/opt/oracle/instantclient_12_1/sdk/demo/procobdemo.pco
/opt/oracle/instantclient_12_1/sdk/demo/setuporamysql.sh
/opt/oracle/instantclient_12_1/sdk/include
/opt/oracle/instantclient_12_1/sdk/include/ldap.h
/opt/oracle/instantclient_12_1/sdk/include/nzerror.h
/opt/oracle/instantclient_12_1/sdk/include/nzt.h
/opt/oracle/instantclient_12_1/sdk/include/occiAQ.h
/opt/oracle/instantclient_12_1/sdk/include/occiCommon.h
/opt/oracle/instantclient_12_1/sdk/include/occiControl.h
/opt/oracle/instantclient_12_1/sdk/include/occiData.h
/opt/oracle/instantclient_12_1/sdk/include/occi.h
/opt/oracle/instantclient_12_1/sdk/include/occiObjects.h
/opt/oracle/instantclient_12_1/sdk/include/oci1.h
/opt/oracle/instantclient_12_1/sdk/include/oci8dp.h
/opt/oracle/instantclient_12_1/sdk/include/ociap.h
/opt/oracle/instantclient_12_1/sdk/include/ociapr.h
/opt/oracle/instantclient_12_1/sdk/include/ocidef.h
/opt/oracle/instantclient_12_1/sdk/include/ocidem.h
/opt/oracle/instantclient_12_1/sdk/include/ocidfn.h
/opt/oracle/instantclient_12_1/sdk/include/ociextp.h
/opt/oracle/instantclient_12_1/sdk/include/oci.h
/opt/oracle/instantclient_12_1/sdk/include/ocikpr.h
/opt/oracle/instantclient_12_1/sdk/include/ocixmldb.h
/opt/oracle/instantclient_12_1/sdk/include/ocixstream.h
/opt/oracle/instantclient_12_1/sdk/include/odci.h
/opt/oracle/instantclient_12_1/sdk/include/oraca.h
/opt/oracle/instantclient_12_1/sdk/include/oratypes.h
/opt/oracle/instantclient_12_1/sdk/include/orid.h
/opt/oracle/instantclient_12_1/sdk/include/ori.h
/opt/oracle/instantclient_12_1/sdk/include/orl.h
/opt/oracle/instantclient_12_1/sdk/include/oro.h
/opt/oracle/instantclient_12_1/sdk/include/ort.h
/opt/oracle/instantclient_12_1/sdk/include/sql2oci.h
/opt/oracle/instantclient_12_1/sdk/include/sqlapr.h
/opt/oracle/instantclient_12_1/sdk/include/sqlca.h
/opt/oracle/instantclient_12_1/sdk/include/sqlcpr.h
/opt/oracle/instantclient_12_1/sdk/include/sqlda.h
/opt/oracle/instantclient_12_1/sdk/include/sqlkpr.h
/opt/oracle/instantclient_12_1/sdk/include/sqlucs2.h
/opt/oracle/instantclient_12_1/sdk/include/xa.h
/opt/oracle/instantclient_12_1/sdk/ott
/opt/oracle/instantclient_12_1/sdk/ottclasses.zip
/opt/oracle/instantclient_12_1/sdk/proc
/opt/oracle/instantclient_12_1/sdk/procob
/opt/oracle/instantclient_12_1/sdk/rtsora
/opt/oracle/instantclient_12_1/sdk/SDK_README
/opt/oracle/instantclient_12_1/sqlplus
/opt/oracle/instantclient_12_1/SQLPLUS_README
/opt/oracle/instantclient_12_1/uidrvci
/opt/oracle/instantclient_12_1/xstreams.jar
            </pre><p>
	    If your installation layout is different, adjust the following 
	    steps as necessary.
	  </p><p>
	    Oracle Instant Client does not provide 
	    <code class="filename">oracle_env.sh</code>, but some
	    environment variables can be very handy and it is suggested you to
	    create your own <code class="filename">oracle_env.sh</code> as below:
	    </p><pre class="screen">
#!/bin/sh
export LD_LIBRARY_PATH=/opt/oracle/instantclient_12_1:$LD_LIBRARY_PATH
export PATH=/opt/oracle/instantclient_12_1:/opt/oracle/instantclient_12_1/sdk:$PATH
export ORACLE_HOME=/opt/oracle/instantclient_12_1
	    </pre><p>
	    and to put it inside Oracle Instant Client base directory
	    <a href="#ftn.idp56852816" class="footnote" id="idp56852816"><sup class="footnote">[25]</sup></a>:
	    </p><pre class="screen">
tiian@ubuntu1404-64:~/lixa$ ls -la /opt/oracle/instantclient_12_1/oracle_env.sh
-rwxr-xr-- 1 root root 216 mar 10 21:57 /opt/oracle/instantclient_12_1/oracle_env.sh
	    </pre><p>
	    Use it when it's needed with shell sourcing:
	    </p><pre class="screen">
tiian@ubuntu1404-64:~$ . /opt/oracle/instantclient_12_1/oracle_env.sh 
tiian@ubuntu1404-64:~$ echo $LD_LIBRARY_PATH
/opt/oracle/instantclient_12_1:
tiian@ubuntu1404-64:~$ echo $PATH
/opt/oracle/instantclient_12_1:/opt/oracle/instantclient_12_1/sdk:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games
tiian@ubuntu1404-64:~$ echo $ORACLE_HOME
/opt/oracle/instantclient_12_1
	    </pre><p>
	    A possible option to configure a remote database is based on the 
	    "tnsnames.ora" file. It should be put at path 
	    <code class="filename">$ORACLE_HOME/network/admin/tnsnames.ora</code>
	    Here's an example:
	    </p><pre class="screen">
lixa_ora_db=
  (DESCRIPTION=
     (ADDRESS=(PROTOCOL=tcp)(HOST=centos7-oracle12.brenta.org)(PORT=1521))
     (CONNECT_DATA=
        (SERVICE_NAME=orcl.brenta.org)))
	    </pre><p>
	    </p><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	      Configuring Oracle networking feature requires a little bit of
	      experience: be patient and consult official documentation and
	      user group forums to obtain a working configuration.
	    </p></div><p>
	    </p><div class="important" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Important</h3><p>
	      This example configuration uses <code class="filename">lixa_ora_db</code>
	      as the name understood by the Instant Client to reach the
	      database server.
	    </p></div><p>
	  </p><p>
	    The final step is the configuration check. If everything is OK, you
	    should obtain something like this:
	    </p><pre class="screen">
tiian@ubuntu1404-64:~$ sqlplus hr/hr@lixa_ora_db

SQL*Plus: Release 12.1.0.2.0 Production on Fri Jan 13 21:36:05 2017

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Fri Jan 13 2017 21:35:16 +01:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected

SQL&gt; exit
Disconnected from Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production
	    </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56859696"></a>Start the LIXA state server</h4></div></div></div><p>
	    The LIXA state server (daemon) must be started as explained in
	    <a class="xref" href="ch04.html#Starting_the_state_server" title="Starting the state server (lixad)">the section called “Starting the state server (<span class="command"><strong>lixad</strong></span>)”</a>.
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56861056"></a>Build the client program</h4></div></div></div><p>
	    Prepare the client (Application Program) using the below commands
	    (<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	    using <span class="command"><strong>\</strong></span> to help readability, but you may use
	    a single line):
	    </p><div class="table"><table frame="box"><thead><tr><td>System configuration details:</td></tr></thead><tbody><tr><td>
		Remote connection, Ubuntu 14.04, Oracle 12.1 Instant Client
		<pre class="screen">
tiian@ubuntu1404-64:/tmp$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example2_ora.c .
tiian@ubuntu1404-64:/tmp$ gcc example2_ora.c \
&gt; $(/opt/lixa/bin/lixa-config -c -f -l -d) \
&gt; -I/opt/oracle/instantclient_12_1/sdk/include \
&gt; -L/opt/oracle/instantclient_12_1 \
&gt; -Wl,-rpath -Wl,/opt/oracle/instantclient_12_1 \
&gt; -l clntsh -l nnz12 -o example2_ora
		</pre>
	      </td></tr></tbody></table></div><p>
	    Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	    </p><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ldd example2_ora
linux-vdso.so.1 =&gt;  (0x00007fff7649c000)
liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0x00007f32ec40f000)
libclntsh.so.12.1 =&gt; /opt/oracle/instantclient_12_1/libclntsh.so.12.1 (0x00007f32e9452000)
libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f32e9082000)
libgmodule-2.0.so.0 =&gt; /usr/lib/x86_64-linux-gnu/libgmodule-2.0.so.0 (0x00007f32e8e7e000)
libglib-2.0.so.0 =&gt; /lib/x86_64-linux-gnu/libglib-2.0.so.0 (0x00007f32e8b76000)
libxml2.so.2 =&gt; /usr/lib/x86_64-linux-gnu/libxml2.so.2 (0x00007f32e880e000)
liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0x00007f32e85f5000)
libpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f32e83d7000)
libmql1.so =&gt; /opt/oracle/instantclient_12_1/libmql1.so (0x00007f32e8160000)
libipc1.so =&gt; /opt/oracle/instantclient_12_1/libipc1.so (0x00007f32e7de2000)
libnnz12.so =&gt; /opt/oracle/instantclient_12_1/libnnz12.so (0x00007f32e76d8000)
libons.so =&gt; /opt/oracle/instantclient_12_1/libons.so (0x00007f32e7492000)
libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f32e728e000)
libm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007f32e6f88000)
libnsl.so.1 =&gt; /lib/x86_64-linux-gnu/libnsl.so.1 (0x00007f32e6d6d000)
librt.so.1 =&gt; /lib/x86_64-linux-gnu/librt.so.1 (0x00007f32e6b65000)
/lib64/ld-linux-x86-64.so.2 (0x00007f32ec62c000)
libaio.so.1 =&gt; /lib/x86_64-linux-gnu/libaio.so.1 (0x00007f32e6963000)
libclntshcore.so.12.1 =&gt; /opt/oracle/instantclient_12_1/libclntshcore.so.12.1 (0x00007f32e63f0000)
libpcre.so.3 =&gt; /lib/x86_64-linux-gnu/libpcre.so.3 (0x00007f32e61b2000)
libz.so.1 =&gt; /lib/x86_64-linux-gnu/libz.so.1 (0x00007f32e5f98000)
liblzma.so.5 =&gt; /lib/x86_64-linux-gnu/liblzma.so.5 (0x00007f32e5d76000)
libuuid.so.1 =&gt; /lib/x86_64-linux-gnu/libuuid.so.1 (0x00007f32e5b71000)
	    </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56861568"></a>Set-up LIXA environment</h4></div></div></div><p>
	    Set-up the necessary environment variable:
	    </p><pre class="screen">
tiian@ubuntu1404-64:/tmp$ export LIXA_PROFILE=ORA_DYN
tiian@ubuntu1404-64:/tmp$ echo $LIXA_PROFILE
ORAIC_DYN
	    </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56869184"></a>Some checks before program execution</h4></div></div></div><p>
	    We set <code class="varname">LIXA_PROFILE</code> to value
	    <span class="quote">“<span class="quote">ORA_DYN</span>”</span>, looking at
	    <code class="filename">/opt/lixa/etc/lixac_conf.xml</code>:
	    </p><pre class="screen">
    &lt;profile name="ORA_DYN"&gt;
      &lt;sttsrvs&gt;
        &lt;sttsrv&gt;local_1&lt;/sttsrv&gt;
      &lt;/sttsrvs&gt;
      &lt;rsrmgrs&gt;
        &lt;rsrmgr&gt;OracleIC_dynreg&lt;/rsrmgr&gt;
      &lt;/rsrmgrs&gt;
    &lt;/profile&gt;
	    </pre><p>
	    the profile references the Resource Manager named
	    <span class="quote">“<span class="quote">OracleIC_dynreg</span>”</span>, looking again at the config file:
	    </p><pre class="screen">
    &lt;rsrmgr name="OracleIC_dynreg" switch_file="/opt/lixa/lib/switch_oracle_dynreg.so" xa_open_info="Oracle_XA+Acc=P/hr/hr+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+SqlNet=lixa_ora_db+Loose_Coupling=true" xa_close_info="" /&gt;
	    </pre><p>
	    we can discover that our application will access the Oracle
	    database using <code class="systemitem">hr</code>
	    user and writing the trace file to directory 
	    <code class="filename">/tmp</code> (see <code class="constant">LogDir</code>)
	    <a href="#ftn.idp56875088" class="footnote" id="idp56875088"><sup class="footnote">[26]</sup></a>. 
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56869696"></a>Program execution (dynamic registration)</h4></div></div></div><p>
	    Execute the client program and check how the content table changes:
	    </p><pre class="screen">
tiian@ubuntu1404-64:/tmp$ ./example2_ora
INSERT statement executed!
First arg is not 'DELETE', bypassing DELETE statement...
tiian@ubuntu1404-64:/tmp$ sqlplus hr/hr@lixa_ora_db

SQL*Plus: Release 12.1.0.2.0 Production on Wed Jan 18 23:41:11 2017

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Wed Jan 18 2017 23:40:54 +01:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

	    CO COUNTRY_NAME      REGION_ID
-- ---------------------------------------- ----------
	    RS Repubblica San Marino     1

SQL&gt; exit
Disconnected from Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production
tiian@ubuntu1404-64:/tmp$ ./example2_ora DELETE
First arg is 'DELETE', bypassing INSERT statement...
DELETE statement executed!
tiian@ubuntu1404-64:/tmp$ sqlplus hr/hr@lixa_ora_db

SQL*Plus: Release 12.1.0.2.0 Production on Wed Jan 18 23:41:40 2017

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Wed Jan 18 2017 23:41:35 +01:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected

SQL&gt; exit
Disconnected from Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production
	    </pre><p>
	    The example program <code class="filename">example2_ora</code> inserted a
	    row in table <code class="constant">COUNTRIES</code>. Take a look to the
	    trace produced by the Oracle client library for the first 
	    execution ("insert"):
	    </p><pre class="screen">
ORACLE XA: Version 12.1.0.2.0. RM name = 'Oracle_XA'.

234322.16513.1350203008.0:
xaoopen: xa_info=ORACLE_XA+Acc=P/hr/**+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+SqlNet=lixa_ora_db+Loose_Coupling=true,rmid=0,flags=0x0

234322.16513.1350203008.0:
xaolgn_help: version#: 185597952 banner: Oracle Database 11g Release 11.1.0.0.0 - Production

234322.16513.1350203008.0:
xaolgn: sqlxrc/sqlxss completed

234322.16513.1350203008.0:
xaolgn2: return XA_OK

234322.16513.1350203008.0:
xaoopen: xaolgn completed

234322.16513.1350203008.0:
xaoopen: return 0

234322.16513.1350203008.0:
ax_reg: xid=0x4c495841-d3c276e84a95421d95eb86c0563c5fa8-54bfbba0e21ccc50c05577130f0b2f6f, rmid=0, flags=0x0

234322.16513.1350203008.0:
OCITransStart: Attempting

234322.16513.1350203008.0:
OCITransStart: Succeeded

234322.16513.1350203008.0:
xaodynpo 2: rmid=0, state=131

234322.16513.1350203008.0:
xaoend: xid=0x4c495841-d3c276e84a95421d95eb86c0563c5fa8-54bfbba0e21ccc50c05577130f0b2f6f, rmid=0, flags=0x4000000

234322.16513.1350203008.0:
OCITransDetach: Attempting

234322.16513.1350203008.0:
OCITransDetach: Succeeded

234322.16513.1350203008.0:
xaoend: return 0

234322.16513.1350203008.0:
xaocommit: xid=0x4c495841-d3c276e84a95421d95eb86c0563c5fa8-54bfbba0e21ccc50c05577130f0b2f6f, rmid=0, flags=0x40000000

234322.16513.1350203008.0:
OCITransCommit: Attempting

234322.16513.1350203008.0:
xaodynpo 2: rmid=0, state=129

234322.16513.1350203008.0:
OCITransCommit: Succeeded

234322.16513.1350203008.0:
xaocommit: rtn 0

234322.16513.1350203008.0:
xaoclose: xa_info=, rmid=0, flags=0x0

234322.16513.1350203008.0:
OCIServerDetach: Attempting

234322.16513.1350203008.0:
OCIServerDetach: Succeeded

234322.16513.1350203008.0:
xaoclose: rtn 0
	    </pre><p>
	  </p></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="idp56833008"></a>Remote configuration (Instant Client) and Pro*C</h3></div></div></div><div class="note" style="margin-left: 0.5in; margin-right: 0.5in;"><h3 class="title">Note</h3><p>
	  This example has been tested using Red Hat Enterprise Linux 7.3
	  and Oracle Instant Client 12.1
	</p></div><p>
	  Using a remote configuration instead of a local configuration
	  introduces two differences:
	  </p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: bullet; "><li class="listitem" style="list-style-type: disc"><p>
	      the Oracle Database Server must be configured to be accessible
	      from another system: a <span class="emphasis"><em>listener</em></span> must be
	      configured
	    </p></li><li class="listitem" style="list-style-type: disc"><p>
	      the Oracle Instant Client software must be installed and 
	      configured in the system that will connect to the database
	    </p></li></ul></div><p>
	</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56885424"></a>Set-up the Oracle environment (server side)</h4></div></div></div><p>
	    The first part of the Oracle Database Server is pretty the same
	    described in 
	    <a class="xref" href="ch05s04.html#Development_setup_Oracle_environment" title="Set-up the Oracle environment (server side)">the section called “Set-up the Oracle environment (server side)”</a>.
	    All the statements remain valid for Oracle 12c Standard 
	    Edition with the exception of the paths. Here's a default path 
	    installation example:
	    </p><pre class="screen">
[oracle@centos7-oracle12 ~]$ ls -la $ORACLE_HOME/rdbms/admin/xaview.sql
-rw-r--r--. 1 oracle oinstall 1941 Apr 21  2011 /u01/app/oracle/product/12.1.0/dbhome_1/rdbms/admin/xaview.sql
	    </pre><p>	    
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56887632"></a>Configure Oracle Listener</h4></div></div></div><p>
	    Configure at least one Oracle listener as explained in
	    <a class="xref" href="ch05s04.html#Development_configure_Oracle_listener" title="Configure Oracle Listener">the section called “Configure Oracle Listener”</a>.
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56888976"></a>Install and configure Oracle Instant Client</h4></div></div></div><p>
	    Install and configure Oracle Instant Client as explained in
	    <a class="xref" href="ch05s04.html#Development_install_Oracle_Instant_Client" title="Install and configure Oracle Instant Client">the section called “Install and configure Oracle Instant Client”</a>.
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56890416"></a>Configure Oracle Pro*C precompiler</h4></div></div></div><p>
	    If you don't like to use a lot of options on the command line,
	    you will have to configure the content of 
	    <code class="filename">pcscfg.cfg</code>.
	    Here's an example for Red Hat Enterprise Linux 7.3:
	    </p><pre class="screen">
[tiian@rhel73 admin]$ cat /opt/oracle/instantclient_12_1/precomp/admin/pcscfg.cfg 
sys_include=(/usr/include,/usr/lib/gcc/x86_64-redhat-linux/4.8.5/include,/usr/lib/gcc/x86_64-redhat-linux/4.8.2/include)
include=($ORACLE_HOME/sdk/include,/opt/lixa/include)
ltype=short
define=__x86_64__
	    </pre><p>
	    Especially "sys_include" and "include" need your attention.
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56892432"></a>Start the LIXA state server</h4></div></div></div><p>
	    The LIXA state server (daemon) must be started as explained in
	    <a class="xref" href="ch04.html#Starting_the_state_server" title="Starting the state server (lixad)">the section called “Starting the state server (<span class="command"><strong>lixad</strong></span>)”</a>.
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56893776"></a>Build the client program</h4></div></div></div><p>
	    Prepare the client (Application Program) using the below commands
	    (<span class="command"><strong>gcc</strong></span> command was splitted on several lines 
	    using <span class="command"><strong>\</strong></span> to help readability, but you may use
	    a single line):
	    </p><div class="table"><table frame="box"><thead><tr><td>System configuration details:</td></tr></thead><tbody><tr><td>
		Remote connection, RHEL 7.3, Oracle 12.1 Instant Client
		<pre class="screen">
[tiian@rhel73 ~]$ export PATH=/opt/oracle/instantclient_12_1/sdk:/opt/oracle/instantclient_12_1:$PATH
[tiian@rhel73 ~]$ type proc
proc is /opt/oracle/instantclient_12_1/sdk/proc
[tiian@rhel73 tmp]$ export LD_LIBRARY_PATH=/opt/oracle/instantclient_12_1:$LD_LIBRARY_PATH
[tiian@rhel73 tmp]$ echo $LD_LIBRARY_PATH
/opt/oracle/instantclient_12_1:
[tiian@rhel73 tmp]$ cp /opt/lixa/share/doc/lixa-X.Y.Z/examples/example14_ora.pc .
[tiian@rhel73 tmp]$ proc code=ANSI_C example14_ora.pc
[tiian@rhel73 tmp]$ gcc example14_ora.c -Wno-unused-variable \
&gt; $(/opt/lixa/bin/lixa-config -c -f -l -d) \
&gt; -I/opt/oracle/instantclient_12_1/sdk/include \
&gt; -L/opt/oracle/instantclient_12_1 \
&gt; -Wl,-rpath -Wl,/opt/oracle/instantclient_12_1 \
&gt; -l clntsh -l nnz12 -o example14_ora
		</pre>
	      </td></tr></tbody></table></div><p>
	    Verify the executable produced by <span class="command"><strong>gcc</strong></span>:
	    </p><pre class="screen">
[tiian@rhel73 tmp]$ ldd example14_ora
    linux-vdso.so.1 =&gt;  (0x00007ffc78dc6000)
    liblixac.so.0 =&gt; /opt/lixa/lib/liblixac.so.0 (0x00007f115d077000)
    libclntsh.so.12.1 =&gt; /opt/oracle/instantclient_12_1/libclntsh.so.12.1 (0x00007f115a0b9000)
    libnnz12.so =&gt; /opt/oracle/instantclient_12_1/libnnz12.so (0x00007f11599af000)
    libc.so.6 =&gt; /lib64/libc.so.6 (0x00007f11595e7000)
    libgmodule-2.0.so.0 =&gt; /lib64/libgmodule-2.0.so.0 (0x00007f11593e2000)
    libgthread-2.0.so.0 =&gt; /lib64/libgthread-2.0.so.0 (0x00007f11591e0000)
    libglib-2.0.so.0 =&gt; /lib64/libglib-2.0.so.0 (0x00007f1158ea9000)
    libxml2.so.2 =&gt; /lib64/libxml2.so.2 (0x00007f1158b3e000)
    liblixab.so.0 =&gt; /opt/lixa/lib/liblixab.so.0 (0x00007f1158926000)
    libm.so.6 =&gt; /lib64/libm.so.6 (0x00007f1158624000)
    libpthread.so.0 =&gt; /lib64/libpthread.so.0 (0x00007f1158407000)
    libmql1.so =&gt; /opt/oracle/instantclient_12_1/libmql1.so (0x00007f1158191000)
    libipc1.so =&gt; /opt/oracle/instantclient_12_1/libipc1.so (0x00007f1157e13000)
    libons.so =&gt; /opt/oracle/instantclient_12_1/libons.so (0x00007f1157bcd000)
    libdl.so.2 =&gt; /lib64/libdl.so.2 (0x00007f11579c9000)
    libnsl.so.1 =&gt; /lib64/libnsl.so.1 (0x00007f11577b0000)
    librt.so.1 =&gt; /lib64/librt.so.1 (0x00007f11575a7000)
    /lib64/ld-linux-x86-64.so.2 (0x00007f115d292000)
    libaio.so.1 =&gt; /lib64/libaio.so.1 (0x00007f11573a5000)
    libclntshcore.so.12.1 =&gt; /opt/oracle/instantclient_12_1/libclntshcore.so.12.1 (0x00007f1156e33000)
    libz.so.1 =&gt; /lib64/libz.so.1 (0x00007f1156c1c000)
    liblzma.so.5 =&gt; /lib64/liblzma.so.5 (0x00007f11569f6000)
    libuuid.so.1 =&gt; /lib64/libuuid.so.1 (0x00007f11567f1000)
	    </pre><p>
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56894288"></a>Set-up LIXA environment</h4></div></div></div><p>
	    Set-up the necessary environment variable:
	    </p><pre class="screen">
tiian@ubuntu1404-64:/tmp$ export LIXA_PROFILE=ORA_STA
tiian@ubuntu1404-64:/tmp$ echo $LIXA_PROFILE
ORA_STA
	    </pre><p>
	    In the previous example we used the dynamic XA registration, this
	    time we are using the static one, but both can be used for 
	    OCI and Pro*C.
	  </p></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="idp56902320"></a>Program execution (static registration)</h4></div></div></div><p>
	    Execute the client program and check how the content table changes:
	    </p><pre class="screen">
[tiian@rhel73 tmp]$ ./example14_ora 
First arg is not 'DELETE', bypassing DELETE statement...
[tiian@rhel73 tmp]$ sqlplus hr/hr@lixa_ora_db

SQL*Plus: Release 12.1.0.2.0 Production on Thu Jan 19 00:30:27 2017

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Thu Jan 19 2017 00:30:11 +01:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

CO COUNTRY_NAME      REGION_ID
-- ---------------------------------------- ----------
RS Repubblica San Marino     1

SQL&gt; exit
Disconnected from Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production
[tiian@rhel73 tmp]$ ./example14_ora DELETE
First arg is 'DELETE', bypassing INSERT statement...
[tiian@rhel73 tmp]$ sqlplus hr/hr@lixa_ora_db

SQL*Plus: Release 12.1.0.2.0 Production on Thu Jan 19 00:30:46 2017

Copyright (c) 1982, 2014, Oracle.  All rights reserved.

Last Successful login time: Thu Jan 19 2017 00:30:45 +01:00

Connected to:
Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production

SQL&gt; select * from COUNTRIES where COUNTRY_ID = 'RS';

no rows selected

SQL&gt; exit
Disconnected from Oracle Database 12c Standard Edition Release 12.1.0.2.0 - 64bit Production
	    </pre><p>
	    The example program <code class="filename">example14_ora</code> inserted a
	    row in table <code class="constant">COUNTRIES</code>. Take a look to the
	    trace produced by the Oracle client library for the second
	    execution ("delete"):
	    </p><pre class="screen">
ORACLE XA: Version 12.1.0.2.0. RM name = 'Oracle_XA'.

003044.3009.2262976064.0:
xaoopen: xa_info=ORACLE_XA+Acc=P/hr/**+SesTm=30+LogDir=/tmp+threads=true+DbgFl=7+SqlNet=lixa_ora_db+Loose_Coupling=true,rmid=0,flags=0x0

003044.3009.2262976064.0:
xaolgn_help: version#: 185597952 banner: Oracle Database 11g Release 11.1.0.0.0 - Production

003044.3009.2262976064.0:
xaolgn: sqlxrc/sqlxss completed

003044.3009.2262976064.0:
xaolgn: return XA_OK

003044.3009.2262976064.0:
xaoopen: xaolgn completed

003044.3009.2262976064.0:
xaoopen: return 0

003044.3009.2262976064.0:
xaostart: xid=0x4c495841-a593cf11a3a24fcb945f6502b6f2210d-c220ba3a3bd0699d93a333c82bbac597, rmid=0, flags=0x0

003044.3009.2262976064.0:
OCITransStart: Attempting

003044.3009.2262976064.0:
OCITransStart: Succeeded

003044.3009.2262976064.0:
xaostart: return XA_OK

003044.3009.2262976064.0:
xaoend: xid=0x4c495841-a593cf11a3a24fcb945f6502b6f2210d-c220ba3a3bd0699d93a333c82bbac597, rmid=0, flags=0x4000000

003044.3009.2262976064.0:
OCITransDetach: Attempting

003044.3009.2262976064.0:
OCITransDetach: Succeeded

003044.3009.2262976064.0:
xaoend: return 0

003044.3009.2262976064.0:
xaocommit: xid=0x4c495841-a593cf11a3a24fcb945f6502b6f2210d-c220ba3a3bd0699d93a333c82bbac597, rmid=0, flags=0x40000000

003044.3009.2262976064.0:
OCITransCommit: Attempting

003044.3009.2262976064.0:
OCITransCommit: Succeeded

003044.3009.2262976064.0:
xaocommit: rtn 0

003044.3009.2262976064.0:
xaoclose: xa_info=, rmid=0, flags=0x0

003044.3009.2262976064.0:
OCIServerDetach: Attempting

003044.3009.2262976064.0:
OCIServerDetach: Succeeded

003044.3009.2262976064.0:
xaoclose: rtn 0
	    </pre><p>
	  </p></div></div><div class="footnotes"><br /><hr style="width:100; text-align:left;margin-left: 0" /><div id="ftn.idp56763088" class="footnote"><p><a href="#idp56763088" class="para"><sup class="para">[21] </sup></a>
	      I put this line (Oracle 10.2 32 bit)
	      <code class="computeroutput">. /usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/oracle_env.sh</code>
	      or this line (Oracle 11.2 64 bit)
	      <code class="computeroutput">. /u01/app/oracle/product/11.2.0/xe/bin/oracle_env.sh</code>
	      in the file <code class="filename">$HOME/.profile</code> of the
	      <code class="systemitem">oracle</code> user to set-up
	      the default administration environment; it complains about
	      two shell errors, but for the sake of our example it's
	      safe.
	    </p></div><div id="ftn.idp56766160" class="footnote"><p><a href="#idp56766160" class="para"><sup class="para">[22] </sup></a>
	      If you got some errors like these:
	      </p><pre class="screen">
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/nls_lang.sh: 114: [[: not found
/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/nls_lang.sh: 114: [[: not found
	      </pre><p>
	      you could edit the file <code class="filename">/usr/lib/oracle/xe/app/oracle/product/10.2.0/server/bin/nls_lang.sh</code> and substitute 
	      <code class="computeroutput">#!/bin/sh</code> with
	      <code class="computeroutput">#!/bin/bash</code> in the first row as explained 
	      here:
	      <a class="link" href="http://forums.oracle.com/forums/thread.jspa?messageID=1542334" target="_top">http://forums.oracle.com/forums/thread.jspa?messageID=1542334</a>
	      </p></div><div id="ftn.idp56807600" class="footnote"><p><a href="#idp56807600" class="para"><sup class="para">[23] </sup></a>
  use </p><pre class="screen">sqlplus hr/hr@lixa_ora_db</pre><p> in the event that you are 
  using a remote connection as explained above
</p></div><div id="ftn.idp56815264" class="footnote"><p><a href="#idp56815264" class="para"><sup class="para">[24] </sup></a>
	      The content of <code class="constant">xa_open_info</code> string is
	      described in chapter 15 "Developing Applications with Oracle XA"
	      of the "Oracle Database Application Developer's Guide"
	      manual; please refer to the documentation published by
	      Oracle Corporation for further details.
	      </p></div><div id="ftn.idp56852816" class="footnote"><p><a href="#idp56852816" class="para"><sup class="para">[25] </sup></a>
	      LIXA test suite, based on <span class="command"><strong>autotest</strong></span> looks for
	      it: if it's not available, Oracle's tests are skipped.
	    </p></div><div id="ftn.idp56875088" class="footnote"><p><a href="#idp56875088" class="para"><sup class="para">[26] </sup></a>
	      The content of <code class="constant">xa_open_info</code> string is
	      described in chapter "Developing Applications with Oracle XA"
	      of the "Oracle Database Application Developer's Guide"
	      manual; please refer to the documentation published by
	      Oracle Corporation for further details.
	    </p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch05s03.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="ch05.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="ch05s05.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">The first example </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> An example with IBM DB2 DBMS</td></tr></table></div></body></html>